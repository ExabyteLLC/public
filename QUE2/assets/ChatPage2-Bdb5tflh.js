import{r as u,o as h,p as v,j as e,e as f,a as Z,P as ee,S as ae,L as g,I as b,c as j,A as y,d as k,f as m,m as re,q as te,M as ne,h as z,s as U,B as I,t as oe,v as T,i as se,w as A,k as le,x as ie,T as P,R as ce,y as de,n as ue}from"./index-DzB4AW6d.js";import{u as S,g as w,M as he,C as ve,a as xe}from"./ChatLoading-D9AO8Imo.js";const pe=a=>{const n=u.useRef(a);return{get value(){return n.current},set value(o){n.current=o},get current(){return n.current},set current(o){n.current=o}}},E=pe;var M={},fe=v;Object.defineProperty(M,"__esModule",{value:!0});var W=M.default=void 0,ge=fe(h()),je=e;W=M.default=(0,ge.default)((0,je.jsx)("path",{d:"M12.5 23c3.04 0 5.5-2.46 5.5-5.5V6h-1.5v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5"}),"AttachFileTwoTone");var $={},ye=v;Object.defineProperty($,"__esModule",{value:!0});var O=$.default=void 0,me=ye(h()),V=e;O=$.default=(0,me.default)([(0,V.jsx)("path",{d:"M8 9h8v10H8z",opacity:".3"},"0"),(0,V.jsx)("path",{d:"m15.5 4-1-1h-5l-1 1H5v2h14V4zM6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM8 9h8v10H8z"},"1")],"DeleteTwoTone");var R={},we=v;Object.defineProperty(R,"__esModule",{value:!0});var K=R.default=void 0,_e=we(h()),F=e;K=R.default=(0,_e.default)([(0,F.jsx)("path",{d:"M13 4H6v16h12V9h-5z",opacity:".3"},"0"),(0,F.jsx)("path",{d:"m20 8-6-6H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2zm-2 12H6V4h7v5h5z"},"1")],"InsertDriveFileTwoTone");var C={},be=v;Object.defineProperty(C,"__esModule",{value:!0});var G=C.default=void 0,Te=be(h()),B=e;G=C.default=(0,Te.default)([(0,B.jsx)("path",{d:"M18 6.41 16.59 5 12 9.58 7.41 5 6 6.41l6 6z"},"0"),(0,B.jsx)("path",{d:"m18 13-1.41-1.41L12 16.17l-4.59-4.58L6 13l6 6z"},"1")],"KeyboardDoubleArrowDownTwoTone");var H={},ze=v;Object.defineProperty(H,"__esModule",{value:!0});var N=H.default=void 0,Se=ze(h()),Me=e;N=H.default=(0,Se.default)((0,Me.jsx)("path",{d:"M3 13h2v-2H3zm0 4h2v-2H3zm0-8h2V7H3zm4 4h14v-2H7zm0 4h14v-2H7zM7 7v2h14V7zm-4 6h2v-2H3zm0 4h2v-2H3zm0-8h2V7H3zm4 4h14v-2H7zm0 4h14v-2H7zM7 7v2h14V7z"}),"ListTwoTone");var D={},$e=v;Object.defineProperty(D,"__esModule",{value:!0});var J=D.default=void 0,Re=$e(h()),q=e;J=D.default=(0,Re.default)([(0,q.jsx)("path",{d:"m4 8.25 7.51 1-7.5-3.22zm.01 9.72 7.5-3.22-7.51 1z",opacity:".3"},"0"),(0,q.jsx)("path",{d:"M2.01 3 2 10l15 2-15 2 .01 7L23 12zM4 8.25V6.03l7.51 3.22zm.01 9.72v-2.22l7.51-1z"},"1")],"SendTwoTone");var L={},Ce=v;Object.defineProperty(L,"__esModule",{value:!0});var Q=L.default=void 0,He=Ce(h()),_=e;Q=L.default=(0,He.default)([(0,_.jsx)("path",{d:"M13 4H6v16h12V9h-5zm3 11h-3v4h-2v-4H8l4.01-4z",opacity:".3"},"0"),(0,_.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5z"},"1"),(0,_.jsx)("path",{d:"M8 15h3v4h2v-4h3l-3.99-4z"},"2")],"UploadFileTwoTone");const De=()=>{const{key:a,rooms:n,status:o,room:t,chat:c,person:l}=S(),s=f(null),i=Z();if(t&&l&&o==="chat")return e.jsxs(ee,{variant:"outlined",sx:{height:"100%"},children:[e.jsxs(ae,{direction:"column",sx:{width:"100%",height:"100%"},children:[e.jsxs(g,{sx:{px:2,py:1,bgcolor:"linkT10.main"},secondaryAction:e.jsx(b,{size:"large",color:"primary",onClick:x=>{s.value=x.target},children:e.jsx(N,{fontSize:"large"})}),children:[e.jsx(j,{sx:{width:50,height:50,minWidth:"unset"},children:e.jsx(y,{variant:"rounded",sx:{bgcolor:k.randomSeed(t.name,{lightness:30}).RGBA,width:50,height:50,"& img":{objectFit:"cover"}},src:w(t.icon),alt:t.name,children:t.name[0]})}),e.jsx(m,{primary:t.name,secondary:t.display_name,primaryTypographyProps:{variant:"h5"},secondaryTypographyProps:{variant:"h6"},sx:{px:2}})]}),t.deleted==="1"&&e.jsx(re,{severity:"warning",children:"Room no longer available!"}),(c.load.waiting||c.history.waiting)&&e.jsx(te,{}),e.jsx(Le,{}),t.deleted==="0"&&e.jsx(ke,{})]}),e.jsx(ne,{anchorEl:s.value,open:!!s.value,onClose:()=>s.value=null,transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:z.toArray(n,(x,r)=>{var d;return e.jsx(g,{disablePadding:!0,children:e.jsxs(U,{onClick:()=>{s.value=null,i(r.url)},children:[e.jsx(j,{sx:{width:30,height:30,minWidth:"unset"},children:e.jsx(y,{variant:"rounded",sx:{bgcolor:k.randomSeed(r==null?void 0:r.room_name,{lightness:30}).RGBA,width:30,height:30,"& img":{objectFit:"cover"}},src:w(r==null?void 0:r.room_icon),alt:r==null?void 0:r.room_name,children:(d=r==null?void 0:r.room_name)==null?void 0:d[0]})}),e.jsx(m,{primary:r==null?void 0:r.room_name,secondary:r==null?void 0:r.room_display_name,secondaryTypographyProps:{variant:"caption",color:"inherit"},sx:{px:1}})]})},`rs-${r.url}`)})})]},a)},Le=()=>{const{messages:a,chat:n,history:o,topMsg:t,clearTopMsg:c}=S(),l=E(null),s=E(null),i=f(!1);u.useEffect(()=>{const r=l.value;function d({target:p}){var X=p.scrollTop,Y=p.scrollHeight-p.offsetHeight;X<Y-100?i.value=!0:i.value=!1}return x(),r.addEventListener("scroll",d),()=>{r.removeEventListener("scroll",d)}},[]),u.useEffect(()=>{const r=l.value;function d({target:p}){o&&!n.history.waiting&&p.scrollTop===0&&n.history.call()}return r.addEventListener("scroll",d),()=>{r.removeEventListener("scroll",d)}},[o,a,n.history]),u.useEffect(()=>{i.value===!1&&x()},[a]),u.useEffect(()=>{var r;t&&((r=document.getElementById(`msg-${t}`))==null||r.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),c())},[t,c]);function x(){var r;(r=s.value)==null||r.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})}return e.jsx(I,{ref:l,sx:{flexGrow:1,flexShrink:0,flexBasis:0,overflow:"auto"},children:e.jsxs(I,{sx:{position:"relative",height:"100%",width:"100%",p:1},children:[z.toArray(a,(r,d)=>e.jsx(Ie,{item:d},`msg-${d.id}`)),e.jsx("div",{style:{position:"sticky",left:"auto",right:10,bottom:10,display:"flex",flexDirection:"row",width:"100%",justifyContent:"flex-end"},children:i.value&&e.jsx(oe,{variant:"contained",size:"small",color:"secondary100",sx:{borderRadius:"50%",p:1},disableElevation:!0,onClick:()=>{i.value=!1,x()},children:e.jsx(G,{})})}),e.jsx("div",{ref:s,style:{paddingTop:10}})]})})},ke=()=>{const{person:a,chat:n}=S(),o=f(null),t=f(null),c=f(null),l=u.useCallback(()=>{(o.value||t.value)&&(n.add.call({bodyData:{chat_person_id:a.id,...o.value?{text:o.value}:{},...t.value?{file:t.value}:{}},onSuccess:()=>{n.new.call()}}),o.value=null,t.value=null)},[a,o,t,n.add]);return u.useEffect(()=>{(async function(){t.value?c.value=await T.getContentAsDataURL(t.value):c.value=null})()},[t]),e.jsxs("div",{children:[t.value&&e.jsxs(g,{sx:{px:1,py:.25,bgcolor:"linkT10.main"},secondaryAction:e.jsx(b,{edge:"end",color:"error",onClick:()=>t.value=null,children:e.jsx(O,{})}),children:[e.jsx(j,{sx:{width:56,height:56,minWidth:"unset"},children:e.jsx(y,{variant:"rounded",sx:{bgcolor:"white.main",width:56,height:56,"& img":{objectFit:"contain"}},src:c.value,alt:t.value.type,children:e.jsx(Q,{color:"primary",size:"large"})})}),e.jsx(m,{primary:t.value.name,secondary:`${Math.ceil(t.value.size/1024)} KB`,secondaryTypographyProps:{variant:"caption"},sx:{px:1}})]}),e.jsx(se,{onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&!s.ctrlKey&&(s.preventDefault(),l())},value:o.value??"",onChange:({target:s})=>{o.value=s.value},name:"message",variant:"standard",placeholder:"Enter message here!",fullWidth:!0,sx:{border:"none",bgcolor:"light.main"},multiline:!0,minRows:1,maxRows:5,InputProps:{sx:{px:1,py:1},disableUnderline:!0,startAdornment:e.jsx(A,{position:"start",sx:{height:"100%",maxHeight:"unset",alignItems:"start"},children:e.jsxs(b,{component:"label",color:"primary",sx:{mx:1,p:1},size:"large",children:[e.jsx(W,{}),e.jsx("input",{value:"",type:"file",name:"attachment",hidden:!0,onChange:({target:s})=>{var i;t.value=(i=s.files)==null?void 0:i[0]}})]})}),endAdornment:e.jsx(A,{position:"end",sx:{height:"100%",maxHeight:"unset",alignItems:"start"},children:e.jsx(le,{type:"submit",variant:"contained",color:"primary",disableElevation:!0,loading:n.add.waiting,sx:{minWidth:0,p:1},disabled:!t.value&&!o.value,onClick:()=>{l()},children:e.jsx(J,{})})})}})]})},Ie=({item:a})=>{const n=a.sender==="guest",o=u.useCallback(()=>{let l=new Date(a.addstamp);return l.toLocaleString("en-US",{day:"numeric",month:"short",year:"numeric"})===new Date().toLocaleString("en-US",{day:"numeric",month:"short",year:"numeric"})?l.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}):l.toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",hour12:!0})},[a]),t=u.useCallback(()=>a.file?e.jsx(g,{disablePadding:!0,children:e.jsxs(U,{component:ie,sx:{px:1,pt:2,bgcolor:"linkT20.main"},onClick:async()=>{var l=await T.fetchAsText(w(a==null?void 0:a.file));await T.downloadData(a==null?void 0:a.file_name,l,a==null?void 0:a.file_type)},children:[e.jsx(j,{sx:{width:45,height:45,minWidth:"unset"},children:e.jsx(y,{variant:"rounded",sx:{bgcolor:"white.main",width:45,height:45,"& img":{objectFit:"contain"}},src:w(a==null?void 0:a.file),alt:a==null?void 0:a.file_type,children:e.jsx(K,{color:"primary",size:"large"})})}),e.jsx(m,{primary:a==null?void 0:a.file_name,secondary:`${Math.ceil((a==null?void 0:a.file_size)/1024)} KB`,secondaryTypographyProps:{variant:"caption",color:"inherit"},sx:{px:1}})]})}):null,[a]),c=u.useCallback(()=>{if(!a.text)return null;let l=a.text.split(`\r
`);return e.jsx(P,{textAlign:"start",sx:{p:1,overflowWrap:"break-word"},children:z.toArray(l,(s,i)=>e.jsxs(ce.Fragment,{children:[i,e.jsx("br",{})]},`msg-${a.id}-t-${s}`))})},[a]);return e.jsx("div",{id:`msg-${a.id}`,style:{display:"flex",flexDirection:"row",width:"100%",justifyContent:n?"flex-end":"flex-start"},children:e.jsxs(de,{sx:{height:"max-content",minWidth:"30%",maxWidth:"60%",bgcolor:n?"primary700.main":"light.main",color:n?"white.main":"dark.main",borderRadius:4,...n?{borderStartEndRadius:0}:{borderStartStartRadius:0},mb:1},elevation:0,children:[t(),c(),e.jsx(P,{textAlign:"end",sx:{px:1,py:.25,fontSize:10},children:o()})]})})},Ve=()=>e.jsx(he,{children:e.jsx(Ae,{})}),Ae=()=>e.jsx(ue,{body:e.jsxs(e.Fragment,{children:[e.jsx(ve,{}),e.jsx(De,{}),e.jsx(xe,{})]}),fixedPage:!0});export{Ve as default};
