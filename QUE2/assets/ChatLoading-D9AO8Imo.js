var ye=Object.defineProperty;var Se=(a,e,r)=>e in a?ye(a,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[e]=r;var M=(a,e,r)=>(Se(a,typeof e!="symbol"?e+"":e,r),r),oe=(a,e,r)=>{if(!e.has(a))throw TypeError("Cannot "+r)};var t=(a,e,r)=>(oe(a,e,"read from private field"),r?r.call(a):e.get(a)),h=(a,e,r)=>{if(e.has(a))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(a):e.set(a,r)},v=(a,e,r,s)=>(oe(a,e,"write to private field"),s?s.call(a,r):e.set(a,r),r);var y=(a,e,r)=>(oe(a,e,"access private method"),r);import{z as J,E as K,F as pe,G as me,H as de,J as se,K as ge,e as R,r as N,N as Ce,O as Ie,Q as fe,U as _e,u as be,j as ae,V as $e,W as Ue}from"./index-DzB4AW6d.js";class le{static get enabled(){try{const e="__E_Storage_Test__";return sessionStorage.setItem(e,null),sessionStorage.removeItem(e),!0}catch{return!1}}static get(e,{json:r=!1}={}){var n;try{var s=sessionStorage.getItem(e);return s&&r&&(s=JSON.parse(s)),s}catch(o){console.trace((n=this==null?void 0:this.constructor)==null?void 0:n.name,o);return}}static set(e,r,{json:s=!1}={}){var n;try{return r&&s&&(r=JSON.stringify(r)),sessionStorage.setItem(e,r),!0}catch(o){return console.trace((n=this==null?void 0:this.constructor)==null?void 0:n.name,o),!1}}static del(e){var r;try{return sessionStorage.removeItem(e),!0}catch(s){return console.trace((r=this==null?void 0:this.constructor)==null?void 0:r.name,s),!1}}}class z{static get enabled(){try{const e="__E_Storage_Test__";return localStorage.setItem(e,null),localStorage.removeItem(e),!0}catch{return!1}}static get(e,{json:r=!1}={}){var n;try{var s=localStorage.getItem(e);return s&&r&&(s=JSON.parse(s)),s}catch(o){console.trace((n=this==null?void 0:this.constructor)==null?void 0:n.name,o);return}}static set(e,r,{json:s=!1}={}){var n;try{return r&&s&&(r=JSON.stringify(r)),localStorage.setItem(e,r),!0}catch(o){return console.trace((n=this==null?void 0:this.constructor)==null?void 0:n.name,o),!1}}static del(e){var r;try{return localStorage.removeItem(e),!0}catch(s){return console.trace((r=this==null?void 0:this.constructor)==null?void 0:r.name,s),!1}}}var ne,w,Q,B,F,H,V,W,U,p,m,D,re,X,ie,I,$;class Te{constructor(e=null,r=null,{headers:s=null,urlData:n=null,bodyData:o=null,responseType:l=null,onStateChange:u=null}={}){h(this,D);h(this,X);h(this,I);h(this,ne,{0:"unsent",1:"opened",2:"uploading",3:"processing",4:"downloading",5:"completed"});h(this,w,new XMLHttpRequest);h(this,Q,null);h(this,B,null);h(this,F,null);h(this,H,null);h(this,V,null);h(this,W,null);h(this,U,null);M(this,"httpCode",null);M(this,"state",null);M(this,"stateText",null);M(this,"error",null);M(this,"response",null);M(this,"stats",{0:null,1:null,2:null,3:null,4:null,5:null});h(this,p,{start:null,total:0,loaded:0,time:0,duration:0,percentage:0,speed:0,estimate:0});h(this,m,{start:null,total:0,loaded:0,time:0,duration:0,percentage:0,speed:0,estimate:0});if(v(this,Q,e),v(this,B,r),v(this,F,s),v(this,H,n),v(this,V,o),v(this,W,l),v(this,U,u),t(this,H)){var f="?";for(var c in t(this,H))f+=`${encodeURIComponent(c)}=${encodeURIComponent(t(this,H)[c])}&`;v(this,B,t(this,B)+f)}y(this,I,$).call(this,0,null)}async send(){return await new Promise(e=>{try{if(t(this,W)&&(t(this,w).responseType=t(this,W)),t(this,w).open(t(this,Q),t(this,B),!0),t(this,F))for(var r in t(this,F))t(this,w).setRequestHeader(r,t(this,F)[r]);t(this,w).onloadstart=()=>y(this,I,$).call(this,1,null),t(this,w).upload.onloadstart=s=>{t(this,U)&&y(this,D,re).call(this,s.total,s.loaded),y(this,I,$).call(this,2,null)},t(this,w).upload.onprogress=s=>{t(this,U)&&y(this,D,re).call(this,s.total,s.loaded),y(this,I,$).call(this,2,null)},t(this,w).upload.onloadend=s=>{t(this,U)&&y(this,D,re).call(this,s.total,s.loaded),y(this,I,$).call(this,3,null)},t(this,w).onprogress=s=>{t(this,U)&&y(this,X,ie).call(this,s.total,s.loaded),y(this,I,$).call(this,4,null)},t(this,w).onloadend=s=>{t(this,U)&&y(this,X,ie).call(this,s.total,s.loaded),this.response=t(this,w).response,y(this,I,$).call(this,5,null),e(this)},t(this,w).ontimeout=()=>{y(this,I,$).call(this,5,"timeout"),e(this)},t(this,w).onabort=()=>{y(this,I,$).call(this,5,"aborted"),e(this)},t(this,w).onerror=()=>{y(this,I,$).call(this,5,"failed"),e(this)},t(this,w).send(t(this,V))}catch(s){y(this,I,$).call(this,5,s)}})}}ne=new WeakMap,w=new WeakMap,Q=new WeakMap,B=new WeakMap,F=new WeakMap,H=new WeakMap,V=new WeakMap,W=new WeakMap,U=new WeakMap,p=new WeakMap,m=new WeakMap,D=new WeakSet,re=function(e,r){t(this,p).start||(t(this,p).start=performance.now()),t(this,p).total=e,t(this,p).loaded=r,t(this,p).duration=performance.now()-t(this,p).start,this.state!==2?(t(this,p).speed=0,t(this,p).estimate=0):(t(this,p).percentage=J(t(this,p).loaded/t(this,p).total*100,2),t(this,p).speed=J(t(this,p).loaded/t(this,p).duration,2),t(this,p).estimate=J((t(this,p).total-t(this,p).loaded)/t(this,p).speed,2))},X=new WeakSet,ie=function(e,r){t(this,m).start||(t(this,m).start=performance.now()),t(this,m).total=e,t(this,m).loaded=r,t(this,m).duration=performance.now()-t(this,m).start,this.state!==4?(t(this,m).speed=0,t(this,m).estimate=0):(t(this,m).percentage=J(t(this,m).loaded/t(this,m).total*100,2),t(this,m).speed=J(t(this,m).loaded/t(this,m).duration,2),t(this,m).estimate=J((t(this,m).total-t(this,m).loaded)/t(this,m).speed,2))},I=new WeakSet,$=function(e,r=null){this.httpCode=t(this,w).status,this.state=e,this.stateText=t(this,ne)[e],this.error=r,this.stats[e]||(this.stats[e]=performance.now(),e>0&&(this.stats[e-1]=this.stats[e]-(this.stats[e-1]??0))),t(this,U)&&t(this,U).call(this,this)};function Re(a){var e;try{if(!K(a))throw`invalid object=${pe(a)}`;let r=[];for(let s in a){let n=a[s];if(me(n))for(let o of n)r.push(`${encodeURIComponent(s)}[]=${encodeURIComponent(o)}`);else r.push(`${encodeURIComponent(s)}=${encodeURIComponent(n)}`)}return r.join("&")}catch(r){console.trace((e=this==null?void 0:this.constructor)==null?void 0:e.name,r);return}}function ue(a,e=!1){return!!(e&&de(a)||!de(a)&&typeof a=="object"&&a instanceof FormData)}function Oe(a,e){var r;try{if(!K(a))throw`invalid object=${pe(a)}`;ue(e)||(e=new FormData);for(let s in a){let n=a[s];if(me(n))for(let o of n)e.append(`${s}[]`,o);else e.append(`${s}`,n)}return e}catch(s){console.trace((r=this==null?void 0:this.constructor)==null?void 0:r.name,s);return}}function je(a){var e;try{if(!ue(a))return{};let r={};for(let s of a.keys())s.indexOf("[]")>-1?r[s.replace("[]","")]=a.getAll(s):r[s]=a.get(s);return r}catch(r){console.trace((e=this==null?void 0:this.constructor)==null?void 0:e.name,r);return}}var j,Y,Z,ee,E,te,P,k,x;class Ee{constructor(e=null,{defaultUrlData:r={},defaultBodyData:s={},defaultHeaders:n={},bodyDataType:o="json",responseHandler:l=d=>se(null,d),responseType:u="json",onBefore:f=()=>{},onAfter:c=()=>{}}={}){h(this,j,null);h(this,Y,null);h(this,Z,null);h(this,ee,null);h(this,E,null);h(this,te,null);h(this,P,null);h(this,k,null);h(this,x,null);v(this,j,e),v(this,Y,n??{}),v(this,Z,r??{}),v(this,ee,s??{}),v(this,E,o),v(this,te,l),v(this,P,u),v(this,k,f),v(this,x,c)}get baseUrl(){return t(this,j)}async call(e,{method:r="POST",headers:s={},urlData:n={},bodyData:o={},bodyDataType:l=t(this,E),responseType:u=t(this,P),onBefore:f=t(this,k),onAfter:c=t(this,x)}={}){var T;try{switch(ge(f)&&f(),K(s)||(s={}),s={...t(this,Y),...s},K(n)||(n={}),n={...t(this,Z),...n},n=Re(n),n&&(n=`?${n}`),ue(o)&&(o=je(o)),K(o)||(o={}),o={...t(this,ee),...o},l){case"formdata":o=Oe(o);break;default:o=JSON.stringify();break}var d=new Te(r,t(this,j)+e+n,{headers:s,responseType:u,bodyData:o});return await d.send(),ge(c)&&c(),t(this,te).call(this,d)}catch(O){return console.trace((T=this==null?void 0:this.constructor)==null?void 0:T.name,O),null}}async callStored(e,{method:r="POST",headers:s={},urlData:n={},bodyData:o={},bodyDataType:l=t(this,E),responseType:u=t(this,P),onBefore:f=t(this,k),onAfter:c=t(this,x),namespace:d="",storage:T="session"}={}){var O;try{let _=`${t(this,j)}${e}${d&&`:${d}`}`,b;if(T==="locale"?b=z.get(_,{json:!0}):b=le.get(_,{json:!0}),b)return se(b.message,b.data);let C=await this.call(e,{method:r,headers:s,urlData:n,bodyData:o,bodyDataType:l,responseType:u,onBefore:f,onAfter:c});return C.success===!1?C:(T==="locale"?z.set(_,{message:C.message,data:C.data},{json:!0}):le.set(_,{message:C.message,data:C.data},{json:!0}),se(C.message,C.data))}catch(_){return console.trace((O=this==null?void 0:this.constructor)==null?void 0:O.name,_),null}}checkStored(e,r="",s="session"){var n;try{let o=`${r}:${t(this,j)}${e}`;return s==="locale"?z.get(o,{json:!0}):le.get(o,{json:!0})}catch(o){return console.trace((n=this==null?void 0:this.constructor)==null?void 0:n.name,o),null}}async lateCall(e){return({method:r="POST",headers:s={},urlData:n={},bodyData:o={},bodyDataType:l=t(this,E),responseType:u=t(this,P),onBefore:f=t(this,k),onAfter:c=t(this,x)}={})=>{this.call(e,{method:r,headers:s,urlData:n,bodyData:o,bodyDataType:l,responseType:u,onBefore:f,onAfter:c})}}async lateCallStored(e){return({method:r="POST",headers:s={},urlData:n={},bodyData:o={},bodyDataType:l=t(this,E),responseType:u=t(this,P),onBefore:f=t(this,k),onAfter:c=t(this,x)}={})=>{this.callStored(e,{method:r,headers:s,urlData:n,bodyData:o,bodyDataType:l,responseType:u,onBefore:f,onAfter:c})}}}j=new WeakMap,Y=new WeakMap,Z=new WeakMap,ee=new WeakMap,E=new WeakMap,te=new WeakMap,P=new WeakMap,k=new WeakMap,x=new WeakMap;const Pe=(a,{fallback:e=null,json:r=!1}={})=>{const s=`${a}`,n=R(()=>z.get(s,{json:r})??e),o=N.useCallback(l=>{l?z.set(s,l,{json:r}):z.del(s)},[s,r]);return N.useLayoutEffect(()=>{o(n.value)},[n,o]),{get value(){return n.value},set value(l){n.value=l},get save(){return o},get set(){return n.set}}},ke=Pe,xe=(a,e,r=!0,s=()=>({method:"POST",headers:{},urlData:{},bodyData:{},bodyDataType:null,responseType:null,onBefore:null,onAfter:null,onSuccess:({message:o,data:l})=>{},onError:({message:o,data:l})=>{}}),n=[])=>{const o=R(r),l=R(null),u=async({method:c="POST",headers:d={},urlData:T={},bodyData:O={},bodyDataType:_=null,responseType:b=null,onBefore:C=null,onAfter:G=null,onSuccess:i=({message:g,data:A})=>{},onError:S=({message:g,data:A})=>{}}={})=>{o.value=!0,l.value=null,setTimeout(async()=>{let g=await a.call(e,{method:c,headers:d,urlData:T,bodyData:O,..._&&_,...b&&b,...C&&C,...G&&G});return o.value=!1,g.success===!1?(S?S(g):alert(g.message),!1):(l.value=g.data,i&&i(g),g.data)},10)},f=N.useCallback(()=>u(Ce.obj(s)?s:s()),[u,s,...n]);return N.useEffect(()=>{r===!0&&!l.value&&f()},[]),{get value(){return l.value},set value(c){l.value=c},get waiting(){return o.value},set waiting(c){o.value=c},get call(){return u},get recall(){return f}}},L=xe,q=new Ee("https://qchat-apis-php-xlosu.ondigitalocean.app/",{defaultHeaders:{"User-Timezone":Ie.now.timezoneOffset},bodyDataType:"formdata",responseType:"json",responseHandler:a=>{if(a.httpCode!==200)return fe("server_error");let e=a.response;return e.status!==200?fe(`${e.status}:${e.statusText}:${e.error}`,e.data):se(e.message,e.data)}}),Ae="https://qchat-uat.syd1.digitaloceanspaces.com/testing";function He(a){if(a)return`${Ae}/${a}`}const ve=_e(()=>{const{roomID:a,personID:e}=be(),r=`${a&&window.atob(decodeURIComponent(a))}-${e&&window.atob(decodeURIComponent(e))}`,s=ke("qrc",{fallback:[],json:!0}),n=R(null),o=R(null),l=R(null),u=R(null),f=R(null),c=R(!1),d=R([]),T=L(q,"public/chat-rooms/get",!!a,()=>({bodyData:{room_id:window.atob(decodeURIComponent(a))},onSuccess:({data:i})=>{n.value="new",o.value=null,l.value=i.room,e&&O.recall()},onError:({message:i,data:S})=>{n.value="error",o.value="invalid_room",console.log("e",i,S)}}),[a]),O=L(q,"public/chat-person/get",!1,()=>({bodyData:{chat_person_id:e&&window.atob(decodeURIComponent(e))},onSuccess:({data:i})=>{n.value="chat",o.value=null,u.value=i.chat_person,_.recall()},onError:({message:i,data:S})=>{n.value="error",o.value="invalid_person",console.log("e",i,S)}}),[e]),_=L(q,"public/chat-person/chat/get",!1,()=>({bodyData:{chat_person_id:e&&window.atob(decodeURIComponent(e))},onSuccess:({data:i})=>{c.value=!(i.chat_messages.length<25),d.value=i.chat_messages}}),[l,u,e]),b=L(q,"public/chat-person/chat/get-new",!1,()=>{var i,S;return{bodyData:{chat_person_id:e&&window.atob(decodeURIComponent(e)),message_id:(S=(i=d.value)==null?void 0:i[d.value.length-1])==null?void 0:S.id},onSuccess:({data:g})=>{d.value=[...d.value,...g.chat_messages]},onError:({message:g,data:A})=>{console.log("err",g,A)}}},[d,e]),C=L(q,"public/chat-person/chat/history",!1,()=>{var i,S;return{bodyData:{chat_person_id:e&&window.atob(decodeURIComponent(e)),message_id:(S=(i=d.value)==null?void 0:i[0])==null?void 0:S.id},onSuccess:({data:g})=>{var ce,he;c.value=!(g.chat_messages.length<25);const A=(he=(ce=d.value)==null?void 0:ce[0])==null?void 0:he.id;d.value=[...g.chat_messages,...d.value],f.value=A},onError:({message:g,data:A})=>{console.log("err",g,A)}}},[d,e]),G=L(q,"public/chat-person/chat/add",!1);return N.useEffect(()=>{if(l.value&&u.value){let i={url:`/chat/${encodeURIComponent(window.btoa(l.value.id))}/${encodeURIComponent(window.btoa(u.value.id))}`,room:l.value.id,person:u.value.id,room_name:l.value.name,room_icon:l.value.icon,room_display_name:l.value.display_name},S=s.value.findIndex(g=>g.room===i.room&&g.person===i.person);if(S>-1){let g=s.value;g[S]=i,s.value=[...g]}else s.value=[...s.value,i]}},[l.value,u.value]),N.useEffect(()=>{l.value=null,u.value=null,d.value=null,f.value=null,c.value=!1,T.recall()},[a,e]),N.useEffect(()=>{if(n.value==="chat"){const i=setInterval(()=>{b.recall()},15e3);return()=>{clearInterval(i)}}},[n,b]),{get key(){return r},get rooms(){return s.value},get status(){return n.value},get error(){return o.value},get waiting(){return T.waiting||O.waiting},get room(){return l.value},get person(){return u.value},get messages(){return d.value},get history(){return c.value},get topMsg(){return f.value},get clearTopMsg(){return()=>f.value=null},get chat(){return{get load(){return{get data(){return _.value},get waiting(){return _.waiting}}},get new(){return{get call(){return b.recall},get waiting(){return b.waiting}}},get add(){return{get call(){return G.call},get waiting(){return G.waiting}}},get history(){return{get call(){return C.recall},get waiting(){return C.waiting}}}}}}}),we=ve.Use,Ne=ve.Provider,Je=()=>{const{status:a,error:e}=we();if(a==="error")return ae.jsxs(ae.Fragment,{children:["error | ",e]})},Le=()=>{const{status:a,waiting:e}=we();if(a===null||e)return ae.jsx($e,{open:!0,children:ae.jsx(Ue,{color:"inherit"})})};export{q as A,Je as C,Ne as M,Le as a,L as e,He as g,we as u};
